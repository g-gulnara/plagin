### Гареева Гульнара Ринатовна М3101
# Расширение для Visual Studio Code

Мой плагин - расширение для Visual Studio Code, которое создает файл `CMakeLists.txt` в корневой папке проекта, если в проекте присутствуют файлы C++.
### Что такое `CMakeLists.txt`?
**CMakeLists.txt** — это файл конфигурации, используемый системой сборки CMake для управления процессом компиляции и сборки проектов на C и C++. Он содержит инструкции и параметры, которые определяют, как проект должен быть собран. Несколько основных причин, почему нужен CMakeLists.txt:

1. **Управление зависимостями**: CMake позволяет указать зависимости между различными модулями и библиотеками, что упрощает управление проектом.
2. **Кросс-платформенность**: CMake поддерживает множество платформ и компиляторов, что позволяет создавать проекты, которые могут быть собраны на различных операционных системах (Windows, macOS, Linux и т.д.) с минимальными изменениями.
3. **Настройка сборки**: В CMakeLists.txt можно указать различные параметры сборки, такие как режимы (Debug, Release), флаги компилятора и другие настройки, которые могут быть важны для процесса сборки.
4. **Генерация файлов сборки**: CMake автоматически генерирует файлы сборки для различных систем (например, Makefile для Unix или проектные файлы для Visual Studio), что упрощает процесс сборки.
5. **Упрощение структуры проекта**: CMakeLists.txt позволяет организовать проект в виде иерархии каталогов и модулей, что делает его более структурированным и удобным для работы.

В целом, CMakeLists.txt является важным инструментом для разработчиков, позволяя им эффективно управлять процессом сборки и зависимостями в проектах на C и C++.

Теперь, о коде программы.
## Импортируемые модули

```typescript
import * as vscode from 'vscode';
import * as fs from 'fs';
import * as path from 'path';
```


- **vscode**: Модуль, предоставляющий API для взаимодействия с Visual Studio Code. Он позволяет расширению взаимодействовать с редактором, окнами, командами и другими функциями.
- **fs**: Модуль для работы с файловой системой, позволяющий читать и записывать файлы.
- **path**: Модуль для работы с путями файловой системы, позволяющий удобно формировать пути к файлам.

## Функция активации

```typescript
export function activate(context: vscode.ExtensionContext) {
```

- **activate**: Функция, которая вызывается при активации расширения. Она принимает контекст расширения в качестве аргумента, который позволяет управлять жизненным циклом расширения. Внутри неё находится команда, которая будет выполнена при ее вызове.
## Определение команды
```typescript
let disposable = vscode.commands.registerCommand('extension.createCMakeLists', async () => {
```

Опеределение команды с идентификатором **extension.createCMakeLists**.

 Эта команда будет вызываться из командной палитры VS Code, когда пользователь решит создать файл CMakeLists.txt.
## Открыта ли папка проекта
```typescript
const workspaceFolders = vscode.workspace.workspaceFolders;
if (!workspaceFolders) {
    vscode.window.showErrorMessage('Откройте папку проекта для создания CMakeLists.txt');
    return;
}
```
Код проверяет, открыта ли папка проекта. Если нет, выводится сообщение об ошибке.
 Получение списка открытых папок в рабочем пространстве. 
Если папка не открыта, выводится сообщение об ошибке.

- **vscode.workspace**: содержит информацию о текущем рабочем пространстве. Рабочее пространство — это папка или набор папок, открытых в редакторе.
- **workspaceFolders**: это свойство объекта `vscode.workspace`, которое возвращает массив папок, открытых в текущем рабочем пространстве. Если в редакторе открыта одна или несколько папок, `workspaceFolders` будет содержать эти папки. Если папка не открыта, это свойство будет равно `undefined`.
- **const workspaceFolders**: константa, которая будет содержать массив открытых папок (или `undefined`, если папки не открыты). Использование const означает, что переменная не может быть переназначена, но ее содержимое (в данном случае массив) может изменяться.
## Получение пути к папке проекта
```typescript
const folderPath = workspaceFolders[0].uri.fsPath;
```
Получение пути к первой открытой папке проекта.
- **workspaceFolders[0]**: workspaceFolders — это массив, содержащий все открытые папки в текущем рабочем пространстве. Индекс [0] указывает на первую папку в этом массиве. Если в рабочем пространстве открыта хотя бы одна папка, то workspaceFolders[0] будет представлять эту первую папку.
- **.uri**: каждый элемент в массиве workspaceFolders представляет собой объект, который содержит информацию о папке. Одним из свойств этого объекта является uri, который представляет собой URI (Uniform Resource Identifier) папки.
- **.fsPath**: свойство fsPath объекта uri возвращает путь к папке в формате, который может быть использован в файловой системе. Это обычная строка, представляющая путь к папке. Использование fsPath позволяет работать с путями в файловой системе, что удобно для операций чтения и записи файлов.
## Проверка наличия файлов C++

```typescript
const files = fs.readdirSync(folderPath);
const hasCppFiles = files.some(file => file.endsWith('.cpp') || file.endsWith('.h'));
```
Чтение содержимого папки и проверка, есть ли в ней файлы с расширениями .cpp или .h.
- **files**: это массив, который содержит имена всех файлов и папок в указанной директории. Он был получен с помощью функции fs.readdirSync(folderPath), которая считывает содержимое папки, путь к которой хранится в переменной folderPath.
- **some()**: это метод массива, который проверяет, удовлетворяет ли хотя бы один элемент массива условию, заданному в переданной функции. Он возвращает true, если хотя бы один элемент соответствует условию, и false, если ни один элемент не соответствует.

```typescript
file => file.endsWith('.cpp') || file.endsWith('.h'):
```
Это стрелочная функция, которая принимает один аргумент file (имя файла) и проверяет, заканчивается ли это имя на .cpp или .h.
- **file.endsWith('.cpp')** возвращает true, если имя файла заканчивается на .cpp, что указывает на то, что это файл исходного кода C++.
- **file.endsWith('.h')** возвращает true, если имя файла заканчивается на .h, что указывает на то, что это заголовочный файл C++.

Сообщение об отсутствии файлов C++
```typescript
if (!hasCppFiles) {
    vscode.window.showErrorMessage('В папке проекта не найдено файлов C++. Убедитесь, что это C++ проект.');
    return;
}
```
Если в папке нет файлов C++, выводится сообщение об ошибке.
## Создание файла CMakeLists.txt
```typescript
const cmakeFilePath = path.join(folderPath, 'CMakeLists.txt');

const cmakeContent = `cmake_minimum_required(VERSION 3.10)

project(MyProject)

set(CMAKE_CXX_STANDARD 11)

add_executable(MyExecutable main.cpp)
`;
```
- **path.join()**: это метод модуля path, который объединяет несколько сегментов пути в один. Он автоматически добавляет необходимые разделители (например, / на Unix-подобных системах и \ на Windows) в зависимости от операционной системы, на которой выполняется код.
Это помогает избежать ошибок, связанных с неправильным форматом пути, и делает код более читаемым.
## Определение пути к файлу CMakeLists.txt и создание его содержимого с необходимыми командами для CMake.
### Запись файла
```typescript
fs.writeFile(cmakeFilePath, cmakeContent, (err) => {
    if (err) {
        vscode.window.showErrorMessage('Ошибка при создании CMakeLists.txt');
        return;
    }
    vscode.window.showInformationMessage('CMakeLists.txt успешно создан!');
});
```
Запись содержимого в файл CMakeLists.txt. Если возникает ошибка, выводится сообщение об ошибке. В противном случае выводится сообщение об успешном создании файла.
## Подписка
Гарантирует правильное освобождение всех ресурсов, связанных с командой.
```typescript
context.subscriptions.push(disposable);
```
- **context**: объект, передаваемый в функцию activate, который содержит информацию о контексте расширения. Он предоставляет доступ к различным API и ресурсам, связанным с расширением, включая подписки на события и команды.
- **subscriptions**: свойство объекта context, которое представляет собой массив. Этот массив используется для хранения подписок на события и ресурсы, которые должны быть очищены, когда расширение деактивируется.
Подписки могут включать команды, обработчики событий и другие ресурсы, которые требуют очистки, чтобы избежать утечек памяти или других проблем.
- **push(disposable)**: метод push() добавляет элемент в конец массива. В данном случае мы добавляем переменную disposable в массив subscriptions.
**disposable** — это объект, который был создан при регистрации команды с помощью vscode.commands.registerCommand. Он представляет собой команду, которую можно удалить или очистить, когда расширение больше не нужно.


### Функция деактивации
```typescript
export function deactivate() {}
```
Функция, которая вызывается при деактивации расширения. В данном случае она не выполняет никаких действий, но может быть использована для очистки ресурсов или завершения процессов, если это необходимо.
##  Заключение
Этот код создает расширение для Visual Studio Code, которое позволяет пользователю создавать файл CMakeLists.txt в проекте C++, проверяя наличие соответствующих файлов в папке проекта. Если в папке нет файлов C++, выводится сообщение об ошибке, что помогает пользователю убедиться, что он работает в правильном контексте.